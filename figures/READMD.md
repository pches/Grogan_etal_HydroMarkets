# This folder contains the data and code for reproducing Figures 2, 3, and 4 
 
## Figure 2: calculate_thresholds_Figure2.R 
This code does 2 steps. (1) It calculates the wet vs paper right threshold for each WMA, based on hydro model output. The result of this step is provided in this folder, in 2 data files called wma_threshold_dates_Scenario2.csv and wma_threshold_dates_Scenario2a.csv. (2) The script uses the 2 provided data files to make the maps shown in Figure 2.  To fully reproduce these maps, you will need to download the WMA shapefile from https://data.msdlive.org/records/v5ree-qj344 and the US State shapefile from https://www.census.gov/geographies/mapping-files/2015/geo/carto-boundary-file.html.  Note: this script uses the raster and rasterViz packages, which are no longer being maintained.  These were the packages originally used to produce the figures, but after publication we can update the code to use the terra package. If you requires code that uses terra, please contact Danielle Grogan for updated code: danielle.grogan@unh.edu. 

## Figure 3: Figure3.R
This code makes each panel of Figure 3 separately. It requires several data sources, including a state shapefile that can be downloaded from https://www.census.gov/geographies/mapping-files/2015/geo/carto-boundary-file.html.  Other data files required are: a trade region shapefile, provided in this repo WWRTradeBounds.zip; three spatial .rdata files provided in this repo (welfare_data_actual.rdata, welfare_data_simulated.rdata, welfare_data_simulated_cutoffs.rdata, and welfare_data_cutoffs_SGMA.rdata); and th .csv files provided int his repo (welfare_region_totals.csv and welfare_gain_by_state_sector.csv). 

## Figure 4: Figure4.py
This code ingests WBM hydrologic output and the water rights before and after altering allocations by the water markets model.  The water rights allocations as cumulative curves are available in the HarDWR database (https://data.msdlive.org/records/y76hr-dvn55), a derivative of the WMA shapefiles (https://data.msdlive.org/records/v5ree-qj344) in NetCDF format identifying each pixel by its "basinNum".  Cumulative curves corresponding to these data following altering allocations through the market model are available at (https://data.msdlive.org/records/ <fill-in> ).  Corresponding WBM model output is available in the same repository (https://data.msdlive.org/record/ <fill-in> ).  Data requirements are described in the script.