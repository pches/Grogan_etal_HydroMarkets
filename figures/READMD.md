# This folder contains the data and code for reproducing Figures 2, 3, 4, and S1

## Figure 2: calculate_thresholds_Figure2.R
This code does 2 steps. (1) It calculates the wet vs paper right threshold for each WMA, based on hydro model output. The result of this step is provided in this folder, in 2 data files called wma_threshold_dates_Scenario2.csv and wma_threshold_dates_Scenario2a.csv. (2) The script uses the 2 provided data files to make the maps shown in Figure 2.  To fully reproduce these maps, you will need to download the WMA shapefile from https://data.msdlive.org/records/v5ree-qj344 and the US State shapefile from https://www.census.gov/geographies/mapping-files/2015/geo/carto-boundary-file.html.  Note: this script uses the raster and rasterViz packages, which are no longer being maintained.  These were the packages originally used to produce the figures, but after publication we can update the code to use the terra package. If you requires code that uses terra, please contact Danielle Grogan for updated code: danielle.grogan@unh.edu.

## Figure 3: Figure3.R
This code makes each panel of Figure 3 separately. It requires several data sources, including a state shapefile that can be downloaded from https://www.census.gov/geographies/mapping-files/2015/geo/carto-boundary-file.html.  Other data files required are: a trade region shapefile, provided in this repo WWRTradeBounds.zip; three spatial .rdata files provided in this repo (welfare_data_actual.rdata, welfare_data_simulated.rdata, welfare_data_simulated_cutoffs.rdata, and welfare_data_cutoffs_SGMA.rdata); and th .csv files provided int his repo (welfare_region_totals.csv and welfare_gain_by_state_sector.csv).

## Figure 4: Figure4.py
This code ingests WBM hydrologic output and the water rights before and after altering allocations by the water markets model.  The water rights allocations as cumulative curves are available in the HarDWR database (https://data.msdlive.org/records/y76hr-dvn55), a derivative of the WMA shapefiles (https://data.msdlive.org/records/v5ree-qj344) in NetCDF format identifying each pixel by its "basinNum".  Cumulative curves corresponding to these data following altering allocations through the market model are available at (https://data.msdlive.org/records/ <fill-in> ).  Corresponding WBM model output is available in the same repository (https://data.msdlive.org/record/ <fill-in> ).  Data requirements are described in the script.

## Figure S1: figureS1_spatialUnits/hydroRealism_figS1_boundaryPanels.R
The figure is a small collection of maps within three panels, labeled A, B, and C. Panel A is an establishing panel, showing the 11 Western States whose water rights were used within the study. Panel B shows the WMAs used for the study, and Panel C shows the the trade region boundaries. The main purpose of this figure is to succinctly show the study region, as well as the geographic differences between the WMAs and the trade regions.

The specific US state and county datasets are the 2018 500k reference boundaries provided by the US Census Bureau (https://www2.census.gov/geo/tiger/GENZ2018/shp/cb_2018_us_state_500k.zip, and respectively https://www2.census.gov/geo/tiger/GENZ2018/shp/cb_2018_us_county_500k.zip). The WMA boundaries is the layer(s) created for the HarDWR dataset (https://data.msdlive.org/records/v5ree-qj344). The trade region boundaries is an amalgamation of data, by state,  from various sources. For Colorado, Idaho, Nevada, and Arizona* the trade regions are the same set of boundaries as their WMAs. For Washington, Oregon, Montana, Utah, Wyoming, and New Mexico the trade regions are those state's counties. For California, the trade regions are the same boundary set as the California i03 Hydrologic Regions (https://gis.data.cnra.ca.gov/datasets/2a572a181e094020bdaeb5203162de15_0/about).

*Among all of the states, Arizona's trading region is unique as it has a single "outside of specifically protected areas" boundary which occupies most of the state's area. This is due to Arizona historically not having water rights in the same sense as the other states, the details of which are more thoroughly explained in the paper. For mapping purposes, the protected AMA and INA areas are extracted from the state's groundwater WMA boundaries. All other boundaries within that layer are dissolved into one shape.
